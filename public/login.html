<!DOCTYPE html>
<html lang="en">
<head>
  <!-- basic -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- mobile metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <!-- site metas -->
  <title>BestWatch - Login</title>
  <meta name="keywords" content="">
  <meta name="description" content="">
  <meta name="author" content="">
  <!-- bootstrap css -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <!-- style css -->
  <link rel="stylesheet" href="css/style.css">
  <!-- Responsive-->
  <link rel="stylesheet" href="css/responsive.css">
  <!-- fevicon -->
  <link rel="icon" href="images/fevicon.png" type="image/gif" />
  <!-- Scrollbar Custom CSS -->
  <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
  <!-- owl stylesheets --> 
  <link rel="stylesheet" href="css/owl.carousel.min.css">
  <link rel="stylesheet" href="css/owl.theme.default.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
</head>
<body>
  <!-- header section start -->
  <div class="header_section">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <a class="logo" href="index.html"><img style="width: 70px; height: 70px;" src="images/logo.png"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
               <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="products.html">Product</a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="cart.html">Cart</a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="shop.html">Shop</a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="contact.html">Contact Us</a>
            </li>
          </ul>
          <form class="form-inline my-2 my-lg-0">
            <div class="search_icon">
              <ul>
                <li><a href="login.html"><img src="images/user-icon.png"></a></li>
              </ul>
            </div>
          </form>
        </div>
    </nav>
  </div>
  <!-- header section end -->

  <div class="container" style="margin-top:50px; margin-bottom:50px;">
    <div class="row">
      <div class="col-md-6 offset-md-3">
        <h2>Login</h2>
        <form action="/auth/login" method="POST">
          <div class="form-group">
            <label>Username</label>
            <input type="text" class="form-control" name="username" required>
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" class="form-control" name="password" required>
          </div>
          <button type="submit" class="btn btn-primary">Login</button>
          <p class="mt-3">Don't have an account? <a href="register.html">Register here</a></p>
        </form>
      </div>
    </div>
  </div>

  <!-- footer section start -->
  <div class="footer_section">
    <div class="container">
      <!-- footer content giống như index -->
      <div class="footer_location_text">
         <ul>
            <li><img src="images/map-icon.png"><span class="padding_left_10"><a href="#">Address here</a></span></li>
            <li><img src="images/call-icon.png"><span class="padding_left_10"><a href="#">Call : +7586656566</a></span></li>
            <li><img src="images/mail-icon.png"><span class="padding_left_10"><a href="#">demo@gmail.com</a></span></li>
         </ul>
      </div>
      <div class="row">
         <div class="col-lg-3 col-sm-6">
            <h2 class="useful_text">Useful link </h2>
            <div class="footer_menu">
               <ul>
                  <li><a href="index.html">Home</a></li>
                  <li><a href="products.html">Product</a></li>
                  <li><a href="cart.html">Cart</a></li>
                  <li><a href="contact.html">Contact Us</a></li>
               </ul>
            </div>
         </div>
         <div class="col-lg-3 col-sm-6">
            <h2 class="useful_text">Repair</h2>
            <p class="lorem_text">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
         </div>
         <div class="col-lg-3 col-sm-6">
            <h2 class="useful_text">Social Media</h2>
            <div id="social">
               <a class="facebookBtn smGlobalBtn" href="#"></a>
               <a class="twitterBtn smGlobalBtn" href="#"></a>
               <a class="googleplusBtn smGlobalBtn" href="#"></a>
               <a class="linkedinBtn smGlobalBtn" href="#"></a>
            </div>
         </div>
         <div class="col-sm-6 col-lg-3">
            <h1 class="useful_text">Our Repair center</h1>
            <p class="footer_text">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
         </div>
      </div>
    </div>
  </div>
  <!-- footer section end -->
  <!-- copyright -->
  <div class="copyright_section">
    <div class="container">
      <p>2020 All Rights Reserved. Design by Free html Templates</p>
    </div>
  </div>
  <!-- JS -->
  <script src="js/jquery.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="js/plugin.js"></script>
  <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="js/custom.js"></script>
  <script src="js/owl.carousel.js"></script>
  <script>
    document.getElementById('login-form').addEventListener('submit', async (e) => {
  e.preventDefault(); // Ngăn form submit mặc định

  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;

  try {
    const response = await fetch('/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password }),
    });

    if (response.ok) {
      const data = await response.json();

      if (data.redirect) {
        window.location.href = data.redirect; // Điều hướng tới trang được trả về
      } else {
        alert('Login successful, but no redirect URL provided.');
      }
    } else {
      const errorMessage = await response.text();
      alert(`Login failed: ${errorMessage}`);
    }
  } catch (err) {
    console.error('Error during login:', err);
    alert('An error occurred during login.');
  }
});

fetch('/auth/me')
  .then((res) => {
    if (!res.ok) {
      throw new Error('Failed to fetch /auth/me');
    }
    return res.json();
  })
  .then((data) => {
    console.log('Auth status:', data); // Log kết quả từ /auth/me
    if (data.loggedIn) {
      if (data.role === 'admin') {
        window.location.href = '/index_admin.html';
      } else if (data.role === 'customer') {
        window.location.href = '/index.html';
      }
    }
  })
  .catch((err) => {
    console.error('Error fetching auth status:', err);
  });
  </script>
</body>
</html>
